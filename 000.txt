mixed-port: 7890
allow-lan: true
mode: Rule
log-level: info
external-controller: 127.0.0.1:9090

proxy-providers:
  SUBSCRIPTION:
    type: http
    url: "https://hMdRto.subxly.cfd:8443/api/v1/client/3bedf52c5cff9447d1b80fbfd21e94ae"
    interval: 3600
    path: ./proxy_providers/sub.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

proxy-groups:
  # 基础组
  - name: 节点选择
    type: select
    proxies:
      - 手动切换
      - 自动选择
      - 🇭🇰 香港节点
      - 🇨🇳 台湾节点
      - 🇸🇬 狮城节点
      - 🇳🇱 荷兰节点
      - 🇯🇵 日本节点
      - 🇺🇲 美国节点
      - 🇰🇷 韩国节点
      - 🇮🇳 印度节点
      - 🇦🇺 澳大利亚节点
      - 🇧🇷 巴西节点
      - 🇩🇪 德国节点
      - 🇫🇷 法国节点
      - 🇬🇧 英国节点
      - 🇪🇸 西班牙节点

  - name: 手动切换
    type: select
    use:
      - SUBSCRIPTION

  - name: 自动选择
    type: url-test
    use:
      - SUBSCRIPTION
    url: http://www.gstatic.com/generate_204
    interval: 300

  # 流媒体组（显示全部节点）
  - name: 油管视频
    type: select
    use:
      - SUBSCRIPTION
    proxies:
      - 节点选择
      - 🇭🇰 香港节点
      - 🇨🇳 台湾节点
      - 🇸🇬 狮城节点
      - 🇳🇱 荷兰节点
      - 🇯🇵 日本节点
      - 🇺🇲 美国节点
      - 🇰🇷 韩国节点
      - 🇮🇳 印度节点
      - 🇦🇺 澳大利亚节点
      - 🇧🇷 巴西节点
      - 🇩🇪 德国节点
      - 🇫🇷 法国节点
      - 🇬🇧 英国节点
      - 🇪🇸 西班牙节点
      - 手动切换
      - 自动选择

  - name: 奈飞视频
    type: select
    use:
      - SUBSCRIPTION
    proxies:
      - 节点选择
      - 🇭🇰 香港节点
      - 🇨🇳 台湾节点
      - 🇸🇬 狮城节点
      - 🇳🇱 荷兰节点
      - 🇯🇵 日本节点
      - 🇺🇲 美国节点
      - 🇰🇷 韩国节点
      - 🇮🇳 印度节点
      - 🇦🇺 澳大利亚节点
      - 🇧🇷 巴西节点
      - 🇩🇪 德国节点
      - 🇫🇷 法国节点
      - 🇬🇧 英国节点
      - 🇪🇸 西班牙节点
      - 手动切换
      - 自动选择

  - name: 迪士尼
    type: select
    use:
      - SUBSCRIPTION
    proxies:
      - 节点选择
      - 🇭🇰 香港节点
      - 🇨🇳 台湾节点
      - 🇸🇬 狮城节点
      - 🇳🇱 荷兰节点
      - 🇯🇵 日本节点
      - 🇺🇲 美国节点
      - 🇰🇷 韩国节点
      - 🇮🇳 印度节点
      - 🇦🇺 澳大利亚节点
      - 🇧🇷 巴西节点
      - 🇩🇪 德国节点
      - 🇫🇷 法国节点
      - 🇬🇧 英国节点
      - 🇪🇸 西班牙节点
      - 手动切换
      - 自动选择

  - name: Max
    type: select
    use:
      - SUBSCRIPTION
    proxies:
      - 节点选择
      - 🇭🇰 香港节点
      - 🇨🇳 台湾节点
      - 🇸🇬 狮城节点
      - 🇳🇱 荷兰节点
      - 🇯🇵 日本节点
      - 🇺🇲 美国节点
      - 🇰🇷 韩国节点
      - 🇮🇳 印度节点
      - 🇦🇺 澳大利亚节点
      - 🇧🇷 巴西节点
      - 🇩🇪 德国节点
      - 🇫🇷 法国节点
      - 🇬🇧 英国节点
      - 🇪🇸 西班牙节点
      - 手动切换
      - 自动选择

  # 其他功能组
  - name: 电报消息
    type: select
    proxies:
      - 节点选择
      - 自动选择

  - name: OpenAi
    type: select
    proxies:
      - 节点选择
      - 自动选择

  - name: 巴哈姆特
    type: select
    proxies:
      - 🇨🇳 台湾节点
      - 节点选择
      - 自动选择

  - name: 哔哩哔哩
    type: select
    proxies:
      - 🇨🇳 台湾节点
      - 🇭🇰 香港节点
      - 全球直连

  - name: 国外媒体
    type: select
    proxies:
      - 节点选择
      - 自动选择

  - name: 国内媒体
    type: select
    proxies:
      - 全球直连
      - 节点选择

  - name: 谷歌FCM
    type: select
    proxies:
      - 节点选择
      - 自动选择

  - name: 微软Bing
    type: select
    proxies:
      - 节点选择
      - 自动选择

  - name: 微软云盘
    type: select
    proxies:
      - 节点选择
      - 自动选择

  - name: 苹果服务
    type: select
    proxies:
      - 全球直连
      - 节点选择

  - name: 游戏平台
    type: select
    proxies:
      - 节点选择
      - 全球直连

  - name: 网易音乐
    type: select
    proxies:
      - 全球直连
      - 节点选择

  - name: 全球直连
    type: select
    proxies:
      - DIRECT

  - name: 漏网之鱼
    type: select
    proxies:
      - 节点选择
      - 全球直连

  # 地区分组
  - name: 🇭🇰 香港节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "香港|HK|Hong Kong"

  - name: 🇨🇳 台湾节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "台湾|台北|TW|Taiwan"

  - name: 🇸🇬 狮城节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "新加坡|狮城|SG|Singapore"

  - name: 🇳🇱 荷兰节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "荷兰|NL|Netherlands"

  - name: 🇯🇵 日本节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "日本|JP|Japan"

  - name: 🇺🇲 美国节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "美国|US|United States"

  - name: 🇰🇷 韩国节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "韩国|KR|Korea"

  - name: 🇮🇳 印度节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "印度|IN|India"

  - name: 🇦🇺 澳大利亚节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "澳大利亚|悉尼|AU|Australia"

  - name: 🇧🇷 巴西节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "巴西|BR|Brazil"

  - name: 🇩🇪 德国节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "德国|DE|Germany"

  - name: 🇫🇷 法国节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "法国|FR|France"

  - name: 🇬🇧 英国节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "英国|UK|United Kingdom"

  - name: 🇪🇸 西班牙节点
    type: select
    use:
      - SUBSCRIPTION
    filter: "西班牙|ES|Spain"

# 高级分流
script:
  code: |
    def main(ctx, metadata):
        domain = metadata["host"] or ""

        # OpenAI
        if "openai.com" in domain or "ai.com" in domain:
            return "OpenAi"

        # YouTube
        if "youtube.com" in domain or "googlevideo.com" in domain or "ytimg.com" in domain:
            return "油管视频"

        # Netflix
        if "netflix.com" in domain or "nflxvideo.net" in domain or "nflxso.net" in domain:
            return "奈飞视频"

        # Disney+
        if "disneyplus.com" in domain or "dssott.com" in domain:
            return "迪士尼"

        # Max (HBO Max)
        if "hbomax.com" in domain or "play.hbomaxcdn.com" in domain:
            return "Max"

        # Telegram
        if "t.me" in domain or "telegram.org" in domain:
            return "电报消息"

        # 巴哈姆特
        if "bahamut.com.tw" in domain or "gamer.com.tw" in domain:
            return "巴哈姆特"

        # 哔哩哔哩
        if "bilibili.com" in domain or "acg.tv" in domain or "b23.tv" in domain:
            return "哔哩哔哩"

        # 网易云音乐
        if "163.com" in domain or "music.126.net" in domain:
            return "网易音乐"

        # 苹果服务
        if "apple.com" in domain or "icloud.com" in domain or "me.com" in domain:
            return "苹果服务"

        # 微软服务
        if "bing.com" in domain:
            return "微软Bing"
        if "onedrive.live.com" in domain or "sharepoint.com" in domain:
            return "微软云盘"

        # Google FCM
        if "googleapis.com" in domain or "gstatic.com" in domain:
            return "谷歌FCM"

        # 游戏平台
        if "epicgames.com" in domain or "steampowered.com" in domain or "xboxlive.com" in domain or "playstation.com" in domain:
            return "游戏平台"

        # 社交媒体
        if "twitter.com" in domain or "facebook.com" in domain or "instagram.com" in domain or "spotify.com" in domain:
            return "国外媒体"

        # 国外网站默认走国外媒体
        if ctx.geoip(metadata["dst_ip"]) != "CN":
            return "国外媒体"

        # 国内网站默认走国内媒体
        if ctx.geoip(metadata["dst_ip"]) == "CN":
            return "国内媒体"

        # 最后兜底
        return "漏网之鱼"

# 兜底规则
rules:
  - GEOIP,CN,国内媒体
  - MATCH,漏网之鱼
